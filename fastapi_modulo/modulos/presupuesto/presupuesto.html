<style>
  .content-section-body #presupuesto-table {
    border-collapse: collapse !important;
    width: 100% !important;
  }
  .content-section-body #presupuesto-table th,
  .content-section-body #presupuesto-table td {
    border: 1px solid rgba(15, 23, 42, 0.25) !important;
  }
  .content-section-body #presupuesto-table th:nth-child(3),
  .content-section-body #presupuesto-table th:nth-child(4),
  .content-section-body #presupuesto-table td:nth-child(3),
  .content-section-body #presupuesto-table td:nth-child(4) {
    text-align: right !important;
  }
  .content-section-body #presupuesto-table .presupuesto-num-input {
    text-align: right !important;
    border: 0 !important;
    outline: 0 !important;
    width: 100% !important;
    background: transparent !important;
    border-radius: 0 !important;
    box-shadow: none !important;
  }
</style>

<section>
  <!-- Encabezado duplicado eliminado -->

  <div>
    <button type="button" id="presupuesto-import-btn" class="color-btn color-btn--ghost">Importar CSV o Excel</button>
    <button type="button" id="presupuesto-export-pdf-btn" class="color-btn color-btn--ghost">Exportar PDF</button>
    <a href="/proyectando/descargar-plantilla-presupuesto" class="color-btn color-btn--primary" download>Descargar plantilla CSV</a>
    <input type="file" id="presupuesto-import-file" accept=".csv,.xlsx,.xlsm,.xltx,.xltm" style="display:none;">
    <span id="presupuesto-action-status"></span>
  </div>

  <section class="form-section">
    <div class="section-title">
      <h2>Fase 9: Presupuesto anual</h2>
    </div>
    <div>
      <button type="button" id="toggle-cod-col-btn" class="color-btn color-btn--ghost">Mostrar columna Cod</button>
    </div>
    <div>
      <table id="presupuesto-table">
        <thead>
          <tr>
            <th class="cod-col" style="display:none;">Cod</th>
            <th>Rubro</th>
            <th>Monto</th>
            <th>Mensual</th>
          </tr>
        </thead>
        <tbody>
          {{ presupuesto_table_rows|safe }}
        </tbody>
      </table>
    </div>
    <div>
      <button type="button" class="color-btn color-btn--primary dg-save-trigger">Guardar presupuesto</button>
      <span class="dg-save-status"></span>
    </div>
  </section>
</section>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    const btn = document.getElementById("toggle-cod-col-btn");
    const codCols = document.querySelectorAll("#presupuesto-table .cod-col");
    let visible = false;
    if (!btn) return;
    btn.addEventListener("click", function() {
      visible = !visible;
      codCols.forEach((col) => {
        col.style.display = visible ? "table-cell" : "none";
      });
      btn.textContent = visible ? "Ocultar columna Cod" : "Mostrar columna Cod";
    });

    const normalizeInteger = (rawValue) => {
      const raw = String(rawValue || "").trim();
      if (!raw) return "";
      const normalized = raw.replace(/,/g, "");
      const value = Number(normalized);
      if (!Number.isFinite(value)) return raw;
      return String(Math.round(value));
    };

    document.querySelectorAll("#presupuesto-table .presupuesto-num-input").forEach((input) => {
      input.value = normalizeInteger(input.value);
      input.style.setProperty("text-align", "right", "important");
    });

    document.querySelectorAll("#presupuesto-table .presupuesto-mensual").forEach((cell) => {
      cell.textContent = normalizeInteger(cell.textContent);
      cell.style.setProperty("text-align", "right", "important");
    });
  });
</script>
